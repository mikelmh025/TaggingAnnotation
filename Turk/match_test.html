<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Match Test</title>
    <style>
        * {
            box-sizing: border-box;
        }

        .container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        .optionContainer {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            width: 95%;
            overflow-x: scroll;
            padding-bottom: 1rem;
        }

        .optionContainer img {
            height: 9rem;
            width: auto;
            margin: 0 8px;
            padding: 1rem;
            border-radius: 0.25rem;
            border: 1px solid white;
        }

        .optionContainer img:hover {
            border-color: black;
        }

        .optionContainer img:focus {
            border: 2px solid #78A55A;
        }

        .buttonGroup{
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            width: 50%;
        }

        button {
            margin-top: 4rem;
            padding: 0.75rem 3rem;
            border: none;
            background-color: #78A55A;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 0.5rem;
            color: white
        }

        .prevButton{
            background-color: black;
        }

        button:disabled {
            background-color: #CCC;
        }

        .optionContainer .selected {
            border: 2px solid #78A55A;
        }

        .hide {
            display: none;
        }
    </style>
</head>

<body>
    <!-- <crowd-form>	    
    <crowd-instructions link-text="View instructions" link-type="button">	
        <short-summary>	
            <p>Task: given the input human image on the left, and cartoon images on the right. </p>	
            <p>Please choose the best matching hair style for the person. </p>	
            <p>Input the hairstyle label</p>	
        </short-summary>	
        <detailed-instructions>	
            <p>Task: given the input human image on the left, and cartoon images on the right. </p>	
            <p>Please choose the best matching hair style for the person. </p>	
            <p>Input the hairstyle label</p>        	
        </detailed-instructions>	
    </crowd-instructions>	
    	
    </crowd-form>  -->

    <head>
        <meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
        <script type='text/javascript' src='https://s3.amazonaws.com/mturk-public/externalHIT_v1.js'></script>
    </head>

    <div class="container" id="group1">
        <h1>1 / 3</h1>
        <img src="${image_person1}" alt="main" class="mainImg" width="200" height="auto" />
        <h2>Please select the most similar hair style</h2>
        <div class="optionContainer">
            <img src="${image_url1_1}" alt="option1" class="opt1" />
            <img src="${image_url1_2}" alt="option2" class="opt2" />
            <img src="${image_url1_3}" alt="option3" class="opt3" />
            <img src="${image_url1_4}" alt="option4" class="opt4" />
            <img src="${image_url1_5}" alt="option5" class="opt5" />
            <img src="${image_url1_6}" alt="option6" class="opt6" />
            <img src="${image_url1_7}" alt="option7" class="opt7" />
            <img src="${image_url1_8}" alt="option8" class="opt8" />
            <img src="${image_url1_9}" alt="option9" class="opt9" />
            <img src="${image_url1_10}" alt="option10" class="opt10" />
        </div>
        <div class="buttonGroup">
            <button class="prevButton" disabled>Previous</button>
            <button class="nextButton" disabled>Next</button>
        </div>
    </div>

    <div class="container hide" id="group2">
        <h1>2 / 3</h1>
        <img src="${image_person2}" alt="main" class="mainImg" width="200" height="auto" />
        <h2>Please select the most similar hair style</h2>
        <div class="optionContainer">
            <img src="${image_url2_1}" alt="option1" class="opt1" />
            <img src="${image_url2_2}" alt="option2" class="opt2" />
            <img src="${image_url2_3}" alt="option3" class="opt3" />
            <img src="${image_url2_4}" alt="option4" class="opt4" />
            <img src="${image_url2_5}" alt="option5" class="opt5" />
            <img src="${image_url2_6}" alt="option6" class="opt6" />
            <img src="${image_url2_7}" alt="option7" class="opt7" />
            <img src="${image_url2_8}" alt="option8" class="opt8" />
            <img src="${image_url2_9}" alt="option9" class="opt9" />
            <img src="${image_url2_10}" alt="option10" class="opt10" />
        </div>
        <div class="buttonGroup">
            <button class="prevButton">Previous</button>
            <button class="nextButton" disabled>Next</button>
        </div>
    </div>

    <div class="container hide" id="group3">
        <h1>3 / 3</h1>
        <img src="${image_person3}" alt="main" class="mainImg" width="200" height="auto" />
        <h2>Please select the most similar hair style</h2>
        <div class="optionContainer">
            <img src="${image_url3_1}" alt="option1" class="opt1" />
            <img src="${image_url3_2}" alt="option2" class="opt2" />
            <img src="${image_url3_3}" alt="option3" class="opt3" />
            <img src="${image_url3_4}" alt="option4" class="opt4" />
            <img src="${image_url3_5}" alt="option5" class="opt5" />
            <img src="${image_url3_6}" alt="option6" class="opt6" />
            <img src="${image_url3_7}" alt="option7" class="opt7" />
            <img src="${image_url3_8}" alt="option8" class="opt8" />
            <img src="${image_url3_9}" alt="option9" class="opt9" />
            <img src="${image_url3_10}" alt="option10" class="opt10" />
        </div>
        <div class="buttonGroup">
            <button class="prevButton">Previous</button>
            <button class="submitButton" disabled>Submit</button>
        </div>
    </div>

    <!-- <script type='text/javascript' src='https://s3.amazonaws.com/mturk-public/externalHIT_v1.js'></script> -->
    <script>

        const group1 = document.querySelector('#group1');
        const group2 = document.querySelector('#group2');
        const group3 = document.querySelector('#group3');

        const optionGroup1 = group1.querySelector('.optionContainer');
        const optionGroup2 = group2.querySelector('.optionContainer');
        const optionGroup3 = group3.querySelector('.optionContainer');

        const imgGroup1 = group1.querySelectorAll('img');
        const imgGroup2 = group2.querySelectorAll('img');
        const imgGroup3 = group3.querySelectorAll('img');

        const next1 =  group1.querySelector('.nextButton');
        const next2 =  group2.querySelector('.nextButton');

        const prev2 =  group2.querySelector('.prevButton');
        const prev3 =  group3.querySelector('.prevButton');

        const imgGroup = document.querySelectorAll('img');
        const optionGroup = document.querySelector('.optionContainer');
        const submitbtn = document.querySelector('.submitButton');
        const result = {};

        imgGroup.forEach((item) => {
            const id = item.src.split('/').pop();
            if (id === 'zzzz') {
                item.classList.add('hide');
            }
        });

        next1.addEventListener("click", () => {
            group1.classList.add('hide');
            group2.classList.remove('hide');
            group3.classList.add('hide');
        })

        next2.addEventListener("click", () => {
            group1.classList.add('hide');
            group2.classList.add('hide');
            group3.classList.remove('hide');
        })

        prev2.addEventListener("click", () => {
            group1.classList.remove('hide');
            group2.classList.add('hide');
            group3.classList.add('hide');
        })

        prev3.addEventListener("click", () => {
            group1.classList.add('hide');
            group2.classList.remove('hide');
            group3.classList.add('hide');
        })



        optionGroup1.addEventListener("click", () => {
            imgGroup1.forEach((item) => item.classList.remove('selected'));
            event.target.classList.add('selected');
            result.group1 = event.target.src
            next1.disabled = false;
            if(result.group1 && result.group2 && result.group3){
                submitbtn.disabled = false;
            }
        })

        optionGroup2.addEventListener("click", () => {
            imgGroup2.forEach((item) => item.classList.remove('selected'));
            event.target.classList.add('selected');
            result.group2 = event.target.src
            next2.disabled = false;
            if(result.group1 && result.group2 && result.group3){
                submitbtn.disabled = false;
            }
        })

        optionGroup3.addEventListener("click", () => {
            imgGroup3.forEach((item) => item.classList.remove('selected'));
            event.target.classList.add('selected');
            result.group3 = event.target.src
            if(result.group1 && result.group2 && result.group3){
                submitbtn.disabled = false;
            }
        })

        submitbtn.addEventListener('click', () => {
            console.log("result", result)
            if (result) {
                const urlParams = new URLSearchParams(window.location.search)

                // create the form element and point it to the correct endpoint
                const form = document.createElement('form')

                console.log('turkSubmitTo: ', urlParams.get('turkSubmitTo'))

                form.action = (new URL('mturk/externalSubmit', urlParams.get('turkSubmitTo'))).href
                // form.action = (new URL('mturk/externalSubmit', 'https://www.mturk.com/')).href
                form.method = 'post'

                // attach the assignmentId
                const inputAssignmentId = document.createElement('input')
                inputAssignmentId.name = 'assignmentId'
                inputAssignmentId.value = urlParams.get('assignmentId')
                inputAssignmentId.hidden = true
                form.appendChild(inputAssignmentId)

                // Attach the data I want to send back
                const inputCoordinates = document.createElement('input')
                inputCoordinates.name = 'result'
                inputCoordinates.value = JSON.stringify(result);
                inputCoordinates.hidden = true
                form.appendChild(inputCoordinates)

                // attach the form to the HTML document and trigger submission
                document.body.appendChild(form)
                form.submit()
            }
        });

    </script>
</body>

</html>